# CA证书

**SSL如何保证网络通信的安全和数据的完整性呢？就是采用了两种手段：身份认证和数据加密。身份认证就需要用到CA证书**

*CA是证书的签发机构，它是公钥基础设施（Public Key Infrastructure，PKI）的核心。CA是负责签发证书、认证证书、管理已颁发证书的机关。*

*CA 拥有一个证书（内含[公钥](https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E5%85%AC%E9%92%A5/6447788)和[私钥](https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E7%A7%81%E9%92%A5/8973452)）。网上的公众用户通过验证 CA 的签字从而信任 CA ，任何人都可以得到 CA 的证书（含公钥），用以验证它所签发的证书。*

*证书的内容包括：[电子签证机关](https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E7%94%B5%E5%AD%90%E7%AD%BE%E8%AF%81%E6%9C%BA%E5%85%B3/3344153)的信息、[公钥](https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E5%85%AC%E9%92%A5/6447788)用户信息、公钥、权威机构的签字和有效期等等。证书的格式和验证方法普遍遵循[X.509](https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/X.509/2817050)国际标准。*

**数据加密**

数字签名：当我们去银行办理业务时，会在业务单上签下自己的名字，这个叫签名。而在网络通信中，签名在网络通讯中的应用称为数字签名，当服务器向客户端发送信息时，会将报文生成报文摘要，同时对报文摘要进行hash计算，得到hash值，然后对hash值进行加密，然后将加密的hash值放置在报文后面，这个加密后的hash值就称为签名。服务器将报文、签名和数字证书一同发送给客户端。客户端收到这些信息后，会首先验证签名，利用签名算法对签名进行解密，得到报文摘要的hash值，然后将得到的报文生成报文摘要并利用签名hash算法生成新的hash值，通过对比这两个hash值是否一致，就能判断信息是否完整，是否是由真正的服务器发送的。可知签名有两个作用确认消息发送方可靠，确认消息完整准确



信息传输的途中，我们的信息很有可能被第三方劫持篡改，所以我们需要保证信息的完整性，通用方法是使用散列算法如SHA1，MD5将传输内容hash一次获得hash值，即摘要。客户端使用服务端的公钥对摘要和信息内容进行加密，然后传输给服务端，服务端使用私钥进行解密获得原始内容和摘要值，这时服务端使用相同的hash算法对原始内容进行hash，然后与摘要值比对，如果一致，说明信息是完整的。







SSL的加密机制：在使用SSL的网络通讯过程中，消息在请求和响应中都是加密传送的。首先要知道加密算法分为两种：**对称加密和非对称加密**。**对称加密就是发送双发使用相同的密钥对消息进行加解密，常见的对称加密为DES、3DES,AES等。非对称加密是发送双方各自拥有一对公钥私钥，其中公钥是公开的，私钥是保密的。当发送方向接收方发送消息时，发送方利用接收方的公钥对消息进行加密，接收方收到消息后，利用自己的私钥解密就能得到消息的明文。其中非对称加密方法有RSA、Elgamal、ECC等**。此处只是简单了说明了这两种加密机制的过程，若要深入理解它们的原理、过程请网上搜索相应的资料。





**使用用户身份信息生成数字签名**



在传输的过程中，客户端如何获得服务器端的公钥呢？当时是服务器分发给客户端，如果一开始服务端发送的公钥到客户端的过程中有可能被第三方劫持，然后第三方自己伪造一对密钥，将公钥发送给客户端，当服务器发送数据给客户端的时候，中间人将信息进行劫持，用一开始劫持的公钥进行解密后，然后使用自己的私钥将数据加密发送给客户端，而客户端收到后使用公钥解密，反过来亦是如此，整个过程中间人是透明的，但信息泄露却不得而知。



为了防止这种情况，数字证书就出现了，它其实就是基于上上面所说的私钥加密数据，公钥解密来验证其身份。
 数字证书是由权威的CA（Certificate Authority）机构给服务端进行颁发，CA机构通过服务端提供的相关信息生成证书，**证书内容包含了持有人的相关信息，服务器的公钥，签署者签名信息（数字签名）等，最重要的是公钥在数字证书中。**

 数字证书是如何保证公钥来自请求的服务器呢？数字证书上由持有人的相关信息，通过这点可以确定其不是一个中间人；但是证书也是可以伪造的，如何保证证书为真呢？
 一个证书中含有三个部分:"证书内容，散列算法，加密密文"，证书内容会被散列算法hash计算出hash值，然后使用CA机构提供的私钥进行RSA加密。



当客户端发起请求时，服务器将该数字证书发送给客户端，客户端通过CA机构提供的公钥对加密密文进行解密获得散列值（数字签名），同时将证书内容使用相同的散列算法进行Hash得到另一个散列值，比对两个散列值，如果两者相等则说明证书没问题。



对称加密方式

![img](http://sylarimage.oss-cn-shenzhen.aliyuncs.com/2021-06-29-145714.jpg)



**CA认证链**

根证书在证书验证中极其重要，而且，根证书是无条件信任的，只要我们将根证书安装上，就说明我们对根证书是信任的，若终端信任根证书，则信任根证书生成的其他证书。终端没有安装相应https证书则不能访问https网站。

![img](http://sylarimage.oss-cn-shenzhen.aliyuncs.com/2021-06-29-145719.jpg)





## Reference

[CA证书详解 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/267047441)

[一文看懂HTTPS、证书机构（CA）、证书、数字签名、私钥、公钥 - 简书 (jianshu.com)](https://www.jianshu.com/p/29e0ba31fb8d)

